
<div class="splitcontentleft">
  <fieldset class="box tabular">
    <legend><%= l(:user_invoices, :num => @user.invoices.count.to_s) %></legend>
    <div class="contextual">
      <%= link_to l(:label_invoice_new), new_invoice_path, :class => 'icon icon-add' if User.current.admin? %>
    </div>

    <% if !@user.invoices.nil? && @user.invoices.count > 0 %>
        <div class="autoscroll">
          <table class="list invoices">
            <thead>
            <tr>
              <th style='width: 15%;text-align:left;'><%= l(:label_numero_fattura) %></th>
              <th style='width: 20%;text-align:left;'><%= l(:label_data_fattura) %></th>
              <th style='width: 15%;text-align:right;'><%= l(:label_sconto) %></th>
              <th style='width: 15%;text-align:right;'><%= l(:label_iva) %></th>
              <th style='width: 20%;text-align:right;'><%= l(:label_prezzo) %></th>
              <th style='width: 10%;text-align:left;'><%= l(:button_download) %></th>
              <th style='width: 5%;'></th>
            </tr>
            </thead>
            <tbody>
            <% @user.invoices.sort_by(&:data_fattura).reverse.each do |invoice| %>
                <tr class="<%= cycle 'odd', 'even' %>">
                  <td align="left">
                    <%= link_to(h(invoice.to_s), invoice_path(invoice), :class => 'icon icon-summary') if User.current.admin? %>
                    <%= h(invoice.to_s) if !User.current.admin? %>
                  </td>
                  <td><%= format_date(invoice.data_fattura) %></td>
                  <td align="right"><%= h invoice.sconto %>
                  <td align="right"><%= h invoice.iva %>
                  <td align="right"><%= h invoice.tariffa %>
                  <td align="left">
                    <%= link_to('PDF', invoice_path(invoice, :format => :pdf), :class => 'icon icon-pdf') %>
                  </td>
                  <%# h smart_truncate(invoice.msg, 100) %></td>
                  <td class="buttons"><%= link_to('', edit_invoice_path(invoice), :class => 'icon icon-edit') if User.current.admin? %>
                    <%= link_to('', invoice_path(invoice), :class => 'icon icon-show') if !User.current.admin? %>
                  </td>
                  <!--td class="buttons"><%= link_to ('', invoice, :confirm => l(:text_are_you_sure), :method => :delete, :class => 'icon icon-del') if User.current.admin? %></td -->
                </tr>
            <% end %>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td class="total buttons"><%= @user.invoices.sum(:tariffa).to_f %></td>
              <td></td>
              <td></td>
            </tr>
          </table>
        </div>
    <% else %>
      <p class="nodata"><%= l(:label_invoices_none) %></p>
    <% end %>
  </fieldset>
</div>

<div class="splitcontentright">
  <% remote_form_for(:user, :url => { :action => 'edit_fatture', :id => @user}, :builder => TabularFormBuilder, :html => {:method => :post}) do |f| %>
  <%# form_for @user, :url => { :action => 'edit_fatture', :id => @user}, :builder => TabularFormBuilder do |f| %>

    <div id="edit_dati_form">
      <fieldset class="box tabular">

        <legend><%=l(:label_dati_pagamento)%></legend>
        <p><%= f.text_field :tariffa_precedente, :label => l(:field_tariffa_precedente), :required => false, :size => 5 %><p>

        <p><%= f.text_field :iva_precedente, :label => :field_iva_precedente, :required => false %></p>

        <p><%= f.text_field :pagamento_precedente, :label => :field_pagamento_precedente %></p>

        <p>   <%= f.text_field :data_ultimo_pagamento, :label => l(:field_data_ultimo_pagamento), :size => 10 %><%= calendar_for('user_data_ultimo_pagamento') %>
        </p>
        <p>
          <%# f.date_select :data_accredito, :label => :field_data_accredito %>
          <%= f.text_field :data_accredito, :label => l(:field_data_accredito), :size => 10 %><%= calendar_for('user_data_accredito') %>
        </p>
        <p>
          <%# f.text_field :anno_competenza, :label => :field_anno_competenza, :required => false, :size => 3  %>
          <% dates = (Date.today.year-5)..(Date.today.year+5)  %>
          <%= f.select(:anno_competenza, dates.collect {|d| [d.to_s,d.to_s]}, {:include_blank => "Select", :selected => @user.anno_competenza.to_s }, {:class => "some_class"} )  %>
          <%# select_year :anno_competenza, {:label => :field_anno_competenza, :required => false, :size => 3, :include_blank => true, :default => nil}  %>
        </p><%= @user.anno_competenza %>
        <p><%= f.text_field :crediti, :label => :field_crediti, :required => false, :size => 3  %></p>

        <p><%= f.text_area :annotazioni, :label => :field_annotazioni, :required => false, :rows => 15 %></p>

      </fieldset>

    </div>
    <p><%= submit_tag l(:button_save_fatture) %></p>
  <% end %>
</div>

<div style="clear:left;"></div>
<%# wikitoolbar_for 'annotazioni' %>
